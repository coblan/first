{% extends 'blog/index.html' %}

{% block art_content %}
<!--<script src="//cdn.ckeditor.com/4.5.8/standard/ckeditor.js"></script>-->
<!--<script src="//cdn.ckeditor.com/4.5.8/standard/ckeditor.js"></script>-->
<!--<script src="/static/ckeditor/ckeditor.js"></script>-->
<script src="http://apps.bdimg.com/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"></script>
<script src="http://apps.bdimg.com/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"></script>

<link rel="stylesheet" href="http://apps.bdimg.com/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css">
<link rel="stylesheet" href="http://apps.bdimg.com/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css">
<!--<script src="/static/blog/"></script>-->

<div class='article'>
	<div id='article'>
		<h2>{{article.title}}</h2>
	</div>
	<hr>
	{{article.html | safe }}
</div>
<!--<textarea name="editor1" id="editor1" rows="10" cols="80">
    This is my textarea to be replaced with CKEditor.
 </textarea>-->
<script type="text/javascript">
	$(function () {

		$('.language-python').each(function () {
			$(this).parent().addClass('brush:python')
			$(this).parent().html($(this).html())
		})
     	SyntaxHighlighter.all();

     	$('#index_container').html(hx.build_index($('#article')))
	})
	
</script>
<script>
    // Replace the <textarea id="editor1"> with a CKEditor
    // instance, using default configuration.
    //CKEDITOR.replace( 'editor1')//,{
	    //	colorButton_backStyle:true,
	    //	//uiColor: '#9AB8F3',
	    //	filebrowserImageUploadUrl: '/blog/upload/image/'
	    //} );
    
    //CKEDITOR.instances.editor.insertHtml('<b>fuck</b>')
    //$('#editor1').val('<b>fuck</b>')
</script>
<script type="text/javascript">
	app.controller('comment',function ($scope,$http) {
		var art_pk='{{art_pk}}'
		$scope.save=function (valid) {
			$scope.submitted=true;
			if(!valid){return}
			if(!confirm("确认要提交吗？？")){return}
			$scope.submit_ing=true;
			var post_data = {
				order:['add_art_comment','get_art_comment'],
				add_art_comment:{art_pk:art_pk,nickname:$scope.nickname,comment:$scope.content},
				get_art_comment:{art_pk:art_pk}
			};  
			$http.post('',post_data)
			.success(function(data, status, headers, config) { 
				$scope.comments=data.get_art_comment.comments
				$scope.nickname=''
				$scope.content=''
				$scope.submitted=false;
				$scope.submit_ing=false;
				if(data.msg){alert(data.msg)}
			}).error(function(data, status, headers, config) {  
			    alert('有错误,返回码为:'+status)
			});
		}
		function init() {
			var post_data = {
				get_art_comment:{art_pk:art_pk}
			};  
			$http.post('',post_data)
			.success(function(data, status, headers, config) { 
				$scope.comments=data.get_art_comment.comments
				if(data.msg){alert(data.msg)}
			}).error(function(data, status, headers, config) {  
			    alert('有错误,返回码为:'+status)
			});
		}
		init();
	})
</script>
<style type="text/css" media="screen" id="test">
	.short-input{
		max-width:300px;
	}
	.middl-input{
		max-width:500px;
	}
	.warn{
		color: red;
	}
	#index_container{
		padding-left:10px;
	}
	#index_container ul{
		padding: 0px;
		
	}
	#index_container li{
		list-style-type:none;
		position: relative;
		/*left:-30px;*/
	}
</style>
<div class='comment' ng-controller='comment' style='margin-top:50px'>
	<h2>留言</h2>
	<form name='comment' ng-submit="save(comment.$valid)" novalidate>
		<div class="form-group short-input" >
		    <label for="nickname">称呼</label>
		    <input type="text" class="form-control" id="nickname" placeholder="nickname" ng-model='nickname' class='short-input' name='nickname' required>
			<span class='warn' ng-show='submitted&&comment.nickname.$error.required'>
				必须要有称呼
			</span>
	  	</div>
	  	<div class='middl-input'>
		  	<textarea class="form-control" rows="3" ng-model='content' name='content' required></textarea>
		  	<span class='warn' ng-show='submitted&&comment.content.$error.required'>
				必须要有内容
			</span>
	  	</div>
	  	<div class='middl-input' style='margin-top:20px;'>
		  	<button class="btn btn-success" type="submit" style='float: right;' ng-disable='submit_ing'>写完了</button>
		  	<span style='clear: both;'>.</span>
	  	</div>
	  	
  	</form>
  	<div ng-repeat='comment in comments | orderBy:"-pk"' style='margin-bottom:30px;'>
	  	<h3><span ng-bind='comment.nickname'></span></h3>
	  	<hr>
	  	<div ng-bind='comment.comment' style='margin-left:30px;'></div>
  	</div>
</div>

{% endblock %}

{% block index %}
<div class='info_panel'>
	<div class='info_head'>
		索引
	</div>
	<div id='index_container'>
		
	</div>
</div>	
{% endblock %}